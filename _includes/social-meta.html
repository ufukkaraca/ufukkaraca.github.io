{%- comment -%}
Reusable social / SEO meta tags.
Logic:
- Base title/description from page or site.
- URL canonicalized.
- Image defaults to site.social_image.
- For thoughts collection, if site.og_dynamic_provider is set, build dynamic OG image URL with query params.
To enable dynamic per-thought cards deploy an OG image function (e.g. Vercel Edge using @vercel/og) and set
og_dynamic_provider in _config.yml.
{%- endcomment -%}
{%- assign meta_title = page.title | default: site.title -%}
{%- assign raw_desc = page.description | default: site.description -%}
{%- assign meta_desc = raw_desc | strip | truncate: 200 -%}
{%- assign meta_url = site.url | append: (page.url | default: '/') -%}
{%- comment -%}
Image priority order:
1. page.social_image (set manually or by build plugin)
2. dynamic provider (if enabled for thoughts and no page.social_image)
3. site.social_image fallback
{%- endcomment -%}
{%- assign meta_image = nil -%}
{%- if page.social_image -%}
{%- assign meta_image = page.social_image -%}
{%- elsif page.collection == 'thoughts' and site.og_dynamic_provider -%}
{%- capture dynamic_image -%}{{ site.og_dynamic_provider }}?title={{ meta_title | uri_escape }}&date={{ page.date | date: '%Y-%m-%d' | uri_escape }}&author={{ site.author | uri_escape }}{%- endcapture -%}
{%- assign meta_image = dynamic_image -%}
{%- else -%}
{%- assign meta_image = site.social_image -%}
{%- endif -%}
{%- unless meta_image contains site.url -%}
{%- assign meta_image = site.url | append: meta_image -%}
{%- endunless -%}

<!-- Primary Meta -->
<meta name="description" content="{{ meta_desc }}">
<meta name="author" content="{{ site.author }}">
<link rel="canonical" href="{{ meta_url }}">

<!-- Open Graph -->
<meta property="og:site_name" content="{{ site.title }}">
<meta property="og:locale" content="en_US">
<meta property="og:title" content="{{ meta_title }}">
<meta property="og:description" content="{{ meta_desc }}">
<meta property="og:type" content="{% if page.collection == 'thoughts' %}article{% else %}website{% endif %}">
<meta property="og:url" content="{{ meta_url }}">
<meta property="og:image" content="{{ meta_image }}">
<meta property="og:image:secure_url" content="{{ meta_image }}">
<meta property="og:image:alt" content="{{ page.social_image_alt | default: meta_title }}">
<meta property="og:image:type" content="image/png">
{%- if page.social_image and page.social_image contains '/assets/og/thought-' -%}
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="600">
{%- endif -%}
<meta name="twitter:image:alt" content="{{ page.social_image_alt | default: meta_title }}">

<!-- Twitter / X -->
<meta name="twitter:card" content="summary_large_image">
{%- if site.X_username -%}
<meta name="twitter:site" content="@{{ site.X_username }}">
<meta name="twitter:creator" content="@{{ site.X_username }}">
{%- endif -%}
<meta name="twitter:title" content="{{ meta_title }}">
<meta name="twitter:description" content="{{ meta_desc }}">
<meta name="twitter:image" content="{{ meta_image }}">
<meta name="twitter:image:alt" content="{{ page.social_image_alt | default: meta_title }}">

{%- if page.collection == 'thoughts' -%}
<!-- Article specific -->
<meta property="article:published_time" content="{{ page.date | date_to_xmlschema }}">
<meta property="article:author" content="{{ site.author }}">
{%- endif -%}